<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>通道控制</title>
    <style>
        *{
        transition: all 0.3s ease;
        }
            body {
                font-family: Arial, sans-serif;
                background-color: #EFF1F0;
            }
            
            .container {
                margin: 20px;
                background-color: #ffffff;
                border-radius: 30px;
                padding: 20px;
            }
            .button-group {
                margin: 10px 0;
            }
            .slider {
                width: 200px;
            }
            .button {
                margin: auto;
                padding: 5px;
                font-size: 14px;/*
                background-color: #f0f0f0;
                border: 1px solid #ccc;*/
                border-radius: 5px;
                cursor: pointer;
            }
            .btmgroup{
                width: 100%;
                display: -webkit-flex; /* Safari */
                display: flex;
                justify-content: space-around;
            }
           /* input{
                width: auto;
                margin: auto;
                padding: 5px;
                font-size: 14px;
                background-color: #f0f0f0;
                border: 1px solid #ccc;
                border-radius: 5px;
                overflow-x: auto;
            }*/
        input {
          background-color: #ffffff;      /* 背景色为白色 */
          border: none;                   /* 移除默认边框 */
          border-bottom: 2px solid #4a90e2;  /* 底部边框 */
          padding: 8px 12px;              /* 内边距 */
          font-size: 16px;                /* 字体大小 */
          transition: border-color 0.3s ease, box-shadow 0.3s ease; /* 添加平滑过渡 */
          width: 100%;                    /* 让输入框在flex布局中自适应宽度 */
        }
        
        input:focus {
          border-bottom: 2px solid #66ccff; /* 聚焦时底部边框变为蓝色 */
         /* box-shadow: 0 0 8px rgba(74, 144, 226, 0.5); 聚焦时的光环 */
          outline: none;                    /* 移除默认的outline */
        }
        
        input:hover {
          border-bottom: 2px solid #66ccff;    /* 鼠标悬停时底部边框颜色 */
        }
        
        button {
          
        
          background-color: #f0f0f0;        /* 按钮背景色，和输入框边框色一致 */
          border: none;                     /* 去除默认边框 */
          border-radius: 8px;               /* 圆角 */
          padding: 10px 16px;               /* 内边距 */
          font-size: 16px;                  /* 字体大小 */
          color: black;                     /* 白色文本 */
          cursor: pointer;                 /* 鼠标指针变为手型 */
          transition: all 0.3s ease;        /* 平滑过渡效果 */
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* 微弱的阴影 */
          border-bottom: 2px solid #ffffff; /* 聚焦时底部边框变为蓝色 */
        }
        
        .button.active {
          border-bottom: 2px solid #4a90e2; /* 聚焦时底部边框变为蓝色 */
         /* box-shadow: 0 0 8px rgba(74, 144, 226, 0.5); 聚焦时的光环 */
          outline: none;                    /* 移除默认的outline */
          color: black
        }
        
        button:active {
          background-color: #66ccff;        /* 按钮按下时的背景色 */
          border-bottom: 2px solid #ffffff; /* 聚焦时底部边框变为蓝色 */
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3); /* 按下时更小的阴影 */
          color: white;
        }
        #svc {
            border: none;
            background-color:inherit;
            box-shadow :none;
            padding: 8px 0;
            }
        
           /* .button.active {
                background-color: #4caf50;
                color: white;
            }
            .button:disabled {
                background-color: #ddd;
                cursor: not-allowed;
            }
            */
            .log-box {
                margin-top: 20px;
                height: 150px;
                border: 1px solid #ccc;
                padding: 10px;
                overflow-y: auto;
                font-size: 12px;
                background-color: #f5f5f5;
            }
    </style>
</head>

<body>

    <div class="container">
        <h2>通道控制</h2>

        <!-- 开关按钮和滑条 -->
        <div id="buttonGroup" class="button-group">
            <div class="btmgroup">
                <input type="range" id="slider" class="slider" min="0" max="100" value="0" list="tickmarks" onchange="slidervchg();" />
                <datalist id="tickmarks">
                    <option value="0"></option>
                    <option value="25"></option>
                    <option value="50"></option>
                    <option value="75"></option>
                    <option value="100"></option>
                </datalist>
                <button id="svc"><span id="sliderv">0%</span></button>
                <button class="button" onclick="setSliderValue(0)">关</button>
                <button class="button" onclick="setSliderValue(100)">满</button>
            </div>
            <hr />
            <div id="buttons">
                <!-- 11个按钮 -->
                <div class="btmgroup">
                    <button id="button1" class="button" onclick="toggleButtonValue(1)">1: 0%</button>
                    <button id="button2" class="button" onclick="toggleButtonValue(2)">2: 0%</button>
                    <button id="button3" class="button" onclick="toggleButtonValue(3)">3: 0%</button>
                    <button id="button4" class="button" onclick="toggleButtonValue(4)">4: 0%</button>
                </div>
                <hr />
                <div class="btmgroup">
                    <button id="button5" class="button" onclick="toggleButtonValue(5)">5: 0%</button>
                    <button id="button6" class="button" onclick="toggleButtonValue(6)">6: 0%</button>
                    <button id="button7" class="button" onclick="toggleButtonValue(7)">7: 0%</button>
                </div>
                <hr />
                <div class="btmgroup">
                    <button id="button8" class="button" onclick="toggleButtonValue(8)">8: 0%</button>
                    <button id="button9" class="button" onclick="toggleButtonValue(9)">9: 0%</button>
                    <button id="button10" class="button" onclick="toggleButtonValue(10)">10: 0%</button>
                    <button id="button11" class="button" onclick="toggleButtonValue(11)">11: 0%</button>
                </div>
            </div>
        </div>
        <hr />
        <hr />
        <!-- 全满/全关/全设置按钮 -->
        <div class="btmgroup">
            <button class="button" onclick="setAllValues(100)">全满</button>
            <button class="button" onclick="setAllValues(0)">全关</button>
            <button class="button" onclick="setAllValues(slider.value)">全设置</button>
        </div>
        <hr />
        <a href="./swipe">切换触摸板控制</a>
        <hr />
        <!-- WS连接控制 -->
        <div>
            <div class="btmgroup">
                <input type="text" id="wst-text" value="请稍等">
                <button class="button" onclick="toggleWSConnection()">✧</button>
                <button class="button" onclick="shareurl()">✈</button>
            </div>
            <p>设备连接状态: <span id="wsStatus">未连接</span></p>
        </div>

        <hr />
        <p>&copy;EterIll & MyZhaZha, 2025.Partial rights reserved.</p>


        <!-- 日志框,记得删 -->
        <hr />
        <h4>日志</h4>
        <div class="log-box" id="logBox"></div>
    </div>

    <script>
        let ws;
        let wsConnected = false;
        const url = new URL(window.location.href);
        let tdip = url.searchParams.get('ip'); 
        let tdport = url.searchParams.get('port');
        if(!tdip){tdip="192.168.69.1";}
        if(!tdport){tdport="81";}
        
        let wstarget = document.getElementById('wst-text');
            
        window.onload = function(){
            wstarget.value = (`${tdip}:${tdport}`);
            }
        function shareurl(){
            let sip = wstarget.value.split(":")[0];
            let spp = wstarget.value.split(":")[1];
            logMessage(`请将以下内容复制后粘贴给你想要分享控制权的对象（需要在同一网络下）：`);
            logMessage(`https://eterill.xyz/OhoVibe/?ip=${sip}&port=${spp}<br/><button onclick="copyToClip(\`https://eterill.xyz/OhoVibe/?ip=${sip}&port=${spp}\`);">点击复制</button>`);
        }
        // 设置滑条数值
        function setSliderValue(value) {
            document.getElementById('slider').value = value;
            slidervchg();
        }
        
        // 同步滑条数值
        function slidervchg() {
            const sliderValue = parseInt(document.getElementById('slider').value);
            document.getElementById('sliderv').innerHTML = `${sliderValue}%`;
        }
        
        // 更新按钮的数值
        function updateButtonValues(sliderValue) {
            const buttons = document.querySelectorAll('#buttons button');
            buttons.forEach(button => {
                const buttonValue = parseInt(button.innerText.split(":")[1]);
                if (buttonValue !== sliderValue) {
                    button.innerText = button.innerText.split(":")[0] + `: ${sliderValue}%`;
                    button.classList.remove('active');
                }
            });
        }
        
        // 切换按钮数值
        function toggleButtonValue(id) {
            const button = document.querySelector(`#button${id}`);
            let currentValue = parseInt(button.innerText.split(":")[1]);
            const sliderValue = parseInt(document.getElementById('slider').value);
        
            if (currentValue === sliderValue) {
                currentValue = 0;
            } else {
                currentValue = sliderValue;
            }
        
            if (currentValue < 1) {
                button.classList.remove('active');
            } else {
                button.classList.add('active');
            }
        
            button.innerText = `${id}: ${currentValue}%`;
            sendWSMessage(id, currentValue);
        }
        /**
         * 复制单行内容到粘贴板
         * content : 需要复制的内容
         * message : 复制完后的提示，不传则默认提示"复制成功"
         */
        function copyToClip(content, message) {
            var aux = document.createElement("input"); 
            aux.setAttribute("value", content); 
            document.body.appendChild(aux); 
            aux.select();
            document.execCommand("copy"); 
            document.body.removeChild(aux);
            if (message == null) {
                alert("复制成功");
            } else{
                alert(message);
            }
        }
        // 设置所有按钮的值
        function setAllValues(value) {
            const buttons = document.querySelectorAll('#buttons button');
            buttons.forEach(button => {
                const id = parseInt(button.id.replace('button', ''));
                button.innerText = `${id}: ${value}%`;
                button.classList.toggle('active', value >= 1);
                
            });
            sendWSMessage(12, value);
        }
        
        // 发送WS消息
        function sendWSMessage(id, value) {
            const wsValue = Math.round((value / 100) * 9999);  // 将0-100%映射到0-9999
            const formattedValue = wsValue.toString().padStart(4, '0');
            const message = `${id - 1}${formattedValue}`;
            //logMessage(`发送命令:${id}-${value}(${message})`);
            //logMessage(`发送:${parseInt(id)===12?"全部":id}-${value}`);
            
            if (wsConnected && ws.readyState === WebSocket.OPEN) {
            logMessage(`发送成功:${parseInt(id)===12?"全部":id}-${value}`);
                ws.send(message);
            }else{
                logMessage(`未连接，发送失败`);
            }
        }
        
        // 连接或断开WS
        function toggleWSConnection() {
            if (wsConnected) {
                ws.close();
                wsConnected = false;
                document.getElementById('wsStatus').innerText = '已断开';
            } else {
            document.getElementById('wsStatus').innerText = '连接中';
                ws = new WebSocket("ws://"+wstarget.value);
                ws.onopen = () => {
                    wsConnected = true;
                    
                    logMessage("连接成功");
                };
                ws.onclose = () => {
                    wsConnected = false;
                    document.getElementById('wsStatus').innerText = '已断开';
                    logMessage("连接断开");
                };
                ws.onerror = () => {
                    logMessage("连接错误");
                };
            }
        }
        
        // 打印日志
        function logMessage(message) {
            const logBox = document.getElementById('logBox');
            logBox.innerHTML += message + '<br>';
            logBox.scrollTop = logBox.scrollHeight;
        }
    </script>

</body>

</html>